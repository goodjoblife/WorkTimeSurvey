"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}function appendJobEndingTime(){for(var e=[],r=now_year;r>now_year-10;r--)e.push(r);e.reverse().map(function(e){$("#form-job-ending-year").append('<option value="'+e+'">'+e+"</option>")});for(var o=[],t=1;t<13;t++)o.push(t);o.map(function(e){$("#form-job-ending-month").append('<option value="'+e+'">'+e+"</option>")}),resetJobEndingTime()}function resetJobEndingTime(){document.querySelector('#form-job-ending-year option[value="'+now_year+'"]').selected=!0,document.querySelector('#form-job-ending-month option[value="'+now_month+'"]').selected=!0}function isPureNumberString(e){return/^\d+(\.\d*)?$/.test(e)}function getRecommendationString(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.href,r=new RegExp("[?&]rec_by(=([^&#]*)|&|#|$)"),o=r.exec(e);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}var showTooltipAndScroll=function(e,r){var o=e.closest(".form-group");o.hasClass("has-error")||(o.addClass("has-error"),o.append('<div class="form-error-message">'+r+"</div>")),$("html, body").animate({scrollTop:e.offset().top-100},600)},showTooltip=function(e,r){var o=e.closest(".form-group");o.hasClass("has-error")||(o.addClass("has-error"),o.append('<div class="form-error-message">'+r+"</div>"))},removeTooltip=function(e){var r=e.closest(".form-group");r.removeClass("has-error"),r.find(".form-error-message").remove()},checkAllBlank=function(e){var r=!0;return e.each(function(){$.trim(this.value)&&(this.checked&&"radio"===$(this).prop("type")?r=!1:this.checked||"radio"===$(this).prop("type")||(r=!1))}),r},$form_input_salary=$("#form-section-salary .maybe-is-required"),$form_input_work_time=$("#form-section-work-time .maybe-is-required, .not-required");$form_input_salary.on("input",function(){$.trim(this.value)?$form_input_salary.addClass("is-required"):checkAllBlank($form_input_salary)&&($form_input_salary.removeClass("is-required"),removeTooltip($form_input_salary))}),$form_input_work_time.on("click input change",function(){"text"===$(this).prop("type")&&$.trim(this.value)||"radio"===$(this).prop("type")&&!0===this.checked?$form_input_work_time.each(function(){$(this).hasClass("maybe-is-required")&&$(this).addClass("is-required")}):checkAllBlank($form_input_work_time)&&($form_input_work_time.removeClass("is-required"),removeTooltip($form_input_work_time))});var $form_input=$("#work-form :input.maybe-is-required");$form_input.on("blur",function(){!$.trim(this.value)&&$(this).hasClass("is-required")?showTooltip($(this),"本欄必填"):removeTooltip($(this))});var $has_fee_options=$("#has-fee-options"),$child_options=$has_fee_options.find('input[name="has_pay"]');$('#select-fee input[name="fee"]').on("click",function(){!0===$("#fee_yes").prop("checked")?$has_fee_options.toggleClass("is-active"):$has_fee_options.removeClass("is-active"),$child_options.prop("checked",!1),$child_options.data("waschecked",!1)}),$(".toggled-radio-button").click(function(){var e=$(this);!0===e.data("waschecked")?(e.prop("checked",!1),e.data("waschecked",!1)):e.data("waschecked",!0),e.parent().siblings().find("input").data("waschecked",!1)});var is_currently_btn=document.querySelectorAll('input[type="radio"][name="is_currently_employed"]'),leave_job_form=document.getElementById("form-job-ending-time"),currentlyChange=function(){resetJobEndingTime(),document.getElementById("form-not-currently-employed").checked?leave_job_form.classList.add("is-active"):leave_job_form.classList.remove("is-active")};Array.prototype.forEach.call(is_currently_btn,function(e){e.addEventListener("change",currentlyChange)});var now_year=(new Date).getFullYear(),now_month=(new Date).getMonth()+1;appendJobEndingTime();var appendJobExperienceTime=function(){$("#form-experience-in-year").append('<option value="0">小於1年</option>');for(var e=1;e<=50;e++)$("#form-experience-in-year").append('<option value="'+e+'">'+e+" 年</option>")};appendJobExperienceTime();var isFacebookSignedIn=!1,$work_form=$("#work-form"),$work_form_submit_button=$("#submit"),ValidationError=function(e){function r(e,o){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.target=o,t}return _inherits(r,e),r}(Error),domToData=function(){return{company_id:$("#form-company-id").val(),company_query:$("#form-company-query").val(),job_title:$("#form-job-title").val(),sector:$("#form-sector").val(),day_promised_work_time:$("#form-day-promised-work-time").val(),day_real_work_time:$("#form-day-real-work-time").val(),week_work_time:$("#form-week-work-time").val(),overtime_frequency:$("#form-overtime-frequency input[name='frequency']:checked").val(),has_overtime_salary:$("#select-fee input[name='fee']:checked").val(),is_overtime_salary_legal:$("#has-fee-options input[name='has_pay']:checked").val(),has_compensatory_dayoff:$("#form-has-compensatory-dayoff input[name='time_off']:checked").val(),email:$("#form-email").val(),is_currently_employed:$('input[type="radio"][name="is_currently_employed"]:checked').val(),job_ending_time_year:$("#form-job-ending-year").val(),job_ending_time_month:$("#form-job-ending-month").val(),employment_type:$("#form-employed-type").val(),gender:$("#form-gender").val(),salary_type:$("#salary-type").val(),salary_amount:$("#salary-amount").val(),experience_in_year:$("#form-experience-in-year").val()}},checkFormField=function(){var e=domToData();if(e.company_query=$.trim(e.company_query),""===e.company_query)throw new ValidationError("需填寫公司/單位",$("#form-company-query"));if(e.job_title=$.trim(e.job_title),""===e.job_title)throw new ValidationError("需填寫職稱",$("#form-job-title"));if(!$("#salary-amount").hasClass("is-required")&&!$("#form-day-promised-work-time").hasClass("is-required"))throw new ValidationError("薪資 / 工時需擇一必填",$("#salary-amount"));if($("#salary-amount").hasClass("is-required")){if(""===e.salary_type)throw new ValidationError("需填寫薪資類型",$("#salary-type"));if(""===e.salary_amount)throw new ValidationError("需填寫薪資",$("#salary-amount"));if(!isPureNumberString(e.salary_amount))throw new ValidationError("僅能包含0到9或小數點，不能有逗號或國字。",$("#salary-amount"));if(""===e.experience_in_year)throw new ValidationError("需填寫相關職務工作經歷",$("#form-experience-in-year"))}if($("#form-day-promised-work-time").hasClass("is-required")){if(""===e.day_promised_work_time)throw new ValidationError("需填寫工作日表定工作時間",$("#form-day-promised-work-time"));if(!isPureNumberString(e.day_promised_work_time))throw new ValidationError("僅能包含0到9或小數點，不能有逗號或國字。",$("#form-day-promised-work-time"));if(e.day_promised_work_time=parseFloat(e.day_promised_work_time),e.day_promised_work_time<0||e.day_promised_work_time>24)throw new ValidationError("工作日表定工作時間範圍為0~24小時",$("#form-day-promised-work-time"));if(""===e.day_real_work_time)throw new ValidationError("需填寫工作日實際工作時間",$("#form-day-real-work-time"));if(!isPureNumberString(e.day_real_work_time))throw new ValidationError("僅能包含0到9或小數點，不能有逗號或國字。",$("#form-day-real-work-time"));if(e.day_real_work_time=parseFloat(e.day_real_work_time),e.day_real_work_time<0||e.day_real_work_time>24)throw new ValidationError("工作日實際工作時間範圍為0~24小時",$("#form-day-real-work-time"));if(""===e.week_work_time)throw new ValidationError("需填寫一週總工時",$("#form-week-work-time"));if(!isPureNumberString(e.week_work_time))throw new ValidationError("僅能包含0到9或小數點，不能有逗號或國字。",$("#form-week-work-time"));if(e.week_work_time=parseFloat(e.week_work_time),e.week_work_time<0||e.week_work_time>168)throw new ValidationError("一週總工時範圍為0~168小時",$("#form-week-work-time"));if(!e.overtime_frequency||""===e.overtime_frequency)throw new ValidationError("需填寫加班頻率",$("#form-overtime-frequency"));if("yes"===e.has_overtime_salary&&(!e.is_overtime_salary_legal||""===e.is_overtime_salary_legal))throw new ValidationError("需填寫是否符合勞基法",$("#select-fee"))}if(!$("#agree").is(":checked"))throw new ValidationError("您必須同意遵守中華民國法律以及本站使用者條款",$("label[for='agree']"))},sendFormData=function(){var e=domToData();$.each(e,function(r,o){o||(e[r]="")}),"yes"===e.is_currently_employed&&(e.job_ending_time_year="",e.job_ending_time_month=""),e.access_token=FB.getAccessToken(),e.company=e.company_query,delete e.company_query;var r=getRecommendationString();null!==r&&(e.recommendation_string=r),$.ajax({url:WTS.constants.backendURL+"workings",method:"POST",data:e,dataType:"json"}).then(function(e){$work_form.trigger("sended",{data:e}),$work_form.trigger("submitted",{data:e})}).fail(function(e,r,o){$work_form_submit_button.prop("disabled",!1),$work_form.trigger("sended",{error:new Error,type:"SendError",jqXHR:e,textStatus:r,errorThrown:o}),$work_form.trigger("submitted",{error:new Error,type:"SendError",jqXHR:e,textStatus:r,errorThrown:o})})};$("#auth_check_text").hide(),$("#auth_check_reminder").hide(),$work_form.on("submit",function(e){e.preventDefault(),$work_form_submit_button.prop("disabled",!0),$work_form.trigger("submitting");try{checkFormField()}catch(e){return $work_form_submit_button.prop("disabled",!1),void $work_form.trigger("submitted",{error:e,type:"ValidationError"})}isFacebookSignedIn?sendFormData():FB.login(function(e){"connected"===e.status?(statusChangeCallback(!0),sendFormData()):(statusChangeCallback(!1),$work_form_submit_button.prop("disabled",!1),$work_form.trigger("submitted",{error:new Error("未登入FB，取消送出資料"),type:"AuthError"}))},{scope:"public_profile,email"})});var auth_check_reminder_timer=null,auth_check_reminder_latency=3e3;$work_form.on("submitting",function(e){$("#submit_text").hide(),$("#auth_check_text").show(),auth_check_reminder_timer=setTimeout(function(){$("#auth_check_reminder").show("slow")},auth_check_reminder_latency)}),$work_form.on("submitted",function(e,r){if($("#submit_text").show(),$("#auth_check_text").hide(),clearTimeout(auth_check_reminder_timer),$("#auth_check_reminder").hide("slow"),r.error)return void("ValidationError"===r.type?showTooltipAndScroll(r.error.target,r.error.message):"AuthError"===r.type?showAlert("alert","Facebook 登入失敗","為了避免使用者大量輸入假資訊，我們會以您的 Facebook 帳戶做驗證。但別擔心！您的帳戶資訊不會以任何形式被揭露、顯示。每一帳戶目前僅能上傳 5 次工時、薪資資訊。","go-fb-login"):"SendError"===r.type&&(0===r.jqXHR.readyState?showAlert("alert","Oops 有些錯誤發生","請查看你的網路連線再試一次！","go-to-form"):4===r.jqXHR.readyState?showAlert("alert","Oops ",r.jqXHR.responseJSON.message,"go-to-form"):showAlert("alert","Oops 有些錯誤發生","請查看你的網路連線再試一次！","go-to-form")));var o=r.data.queries_count;showAlert("success","上傳成功","您已經上傳 "+o+" 次，還有 "+(5-o)+" 次可以上傳。","go-to-show")});var statusChangeCallback=function(e){e?(isFacebookSignedIn=!0,document.querySelector(".fb-login-word").style.display="none",document.querySelector(".btn-why-facebook-login").style.display="none"):(isFacebookSignedIn=!1,document.querySelector(".fb-login-word").style.display="",document.querySelector(".btn-why-facebook-login").style.display="")};$(function(){var e=[],r=[];$.ajax({url:WTS.constants.backendURL+"workings",dataType:"json"}).done(function(o){e=Array.from(new Set($.map(o.time_and_salary,function(e,r){return{value:e.job_title}}))).slice(0,4),r=Array.from(new Set($.map(o.time_and_salary,function(e,r){return{value:e.company.name,company_id:e.company.id}}).filter(function(e){return void 0!==e.company_id}))).slice(0,4)});var o=function(){$(this).autocomplete("search",$(this).val())},t=function(e,r){var o=$(e.currentTarget).find(".ui-state-active");o.parent().hasClass("ui-state-disabled")&&(e.preventDefault(),o.parent().siblings().first().children("div").mouseenter())},a=function(e,r){var o=$("<li>").append($("<div>").text(r.label));return r.disabled&&o.addClass("ui-state-disabled"),o.appendTo(e)},n=$("#form-job-title"),i=$("#form-company-query");n.autocomplete({source:function(r,o){if(n.trigger("autocomplete-search",r.term),0==r.term.length)return void o([{value:"最近被填寫的職位",disabled:!0}].concat(e.map(function(e){return e.disabled=!1,e})));$.ajax({url:WTS.constants.backendURL+"jobs/search",data:{key:r.term},dataType:"json"}).done(function(e){var r=$.map(e,function(e,r){return{value:e.des,id:e._id}});o(r)}).fail(function(e,r){o([])})},minLength:0,select:function(e,r){n.trigger("autocomplete-select",r.item.label)},focus:t}).focus(o).data("ui-autocomplete")._renderItem=a,$("#form-company-query").autocomplete({source:function(e,o){if(i.trigger("autocomplete-search",e.term),e.term.length<2)return void o([{value:"最近被填寫的公司",disabled:!0}].concat(r.map(function(e){return e.disabled=!1,e})));$.ajax({url:WTS.constants.backendURL+"companies/search",data:{key:e.term},dataType:"json"}).done(function(e){var r=[];e.forEach(function(e,o){r.push({value:e.name,company_id:e.id})}),o(r)}).fail(function(e,r){o([])})},minLength:0,select:function(e,r){i.trigger("autocomplete-select",r.item.company_id),$("#form-company-id").val(r.item.company_id)},focus:t}).focus(o).data("ui-autocomplete")._renderItem=a});var formBeginTime=null,formSubmittedTime=null,hasSendedFormWritingTime=!1;$(function(){!function(){function e(e){r||(r=!0,$("#work-form").trigger("beginWriting"))}var r=!1;$("#work-form input").on("focus",e),$("#work-form input").on("click",e),$("#work-form input[type=radio]").on("change",e)}()}),$work_form.one("beginWriting",function(e){formBeginTime=performance.now(),ga&&ga("send","timing","LANDING_PAGE","form-begin-writing",formBeginTime)}),$work_form.on("submitted",function(e,r){if(!r.error&&!hasSendedFormWritingTime){formSubmittedTime=performance.now();var o=formSubmittedTime-formBeginTime;ga&&ga("send","timing","LANDING_PAGE","form-submitted",formSubmittedTime),ga&&ga("send","timing","LANDING_PAGE","form-writing",o),hasSendedFormWritingTime=!0}}),$work_form.on("submit",function(e){ga&&ga("send","event","LANDING_PAGE","click-submit")});var $fb_share_button=$("#fb-share-button"),$twitter_share_button=$("#twitter-share-button");$fb_share_button.on("click",function(e){ga&&ga("send","event","LANDING_PAGE","click-fb-share")}),$twitter_share_button.on("click",function(e){ga&&ga("send","event","LANDING_PAGE","click-twitter-share")}),$work_form.on("submitted",function(e,r){r.error?"ValidationError"===r.type?ga&&ga("send","event","LANDING_PAGE","check-form-fail",r.error.message):"AuthError"===r.type?ga&&ga("send","event","LANDING_PAGE","upload-fail",r.error.message):"SendError"===r.type&&(0===r.jqXHR.readyState?ga&&ga("send","event","LANDING_PAGE","upload-fail","readyState:"+r.jqXHR.readyState):4===r.jqXHR.readyState?ga&&ga("send","event","LANDING_PAGE","upload-fail",r.jqXHR.responseJSON.message):ga&&ga("send","event","LANDING_PAGE","upload-fail",r.error.message)):ga&&ga("send","event","LANDING_PAGE","upload-success")});var $job_title=$("#form-job-title"),$company_query=$("#form-company-query");$job_title.on("autocomplete-search",function(e){ga&&ga("send","event","LANDING_PAGE","job-title-autocomplete-search",e)}),$job_title.on("autocomplete-select",function(e){ga&&ga("send","event","LANDING_PAGE","job-title-autocomplete-select",e)}),$company_query.on("autocomplete-search",function(e){ga&&ga("send","event","LANDING_PAGE","company-query-autocomplete-search",e)}),$company_query.on("autocomplete-search",function(e){ga&&ga("send","event","LANDING_PAGE","company-query-autocomplete-select",e)});